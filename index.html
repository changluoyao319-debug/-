<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠ±è‰²çš‡å† å¼€å¥–æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "å¾®è½¯é›…é»‘", Arial, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
        }
        /* æ¸¸æˆå®¹å™¨ */
        .game-container {
            width: 100%;
            max-width: 500px;
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }
        /* ç§¯åˆ†æ˜¾ç¤º */
        .score-box {
            text-align: center;
            font-size: 22px;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(255,215,0,0.1);
            border-radius: 10px;
            border: 1px solid #ffd700;
        }
        .score {
            color: #ffd700;
            font-weight: bold;
        }
        /* ç›®æ ‡é€‰æ‹©åŒº */
        .targets {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin: 25px 0;
        }
        .target {
            width: 100%;
            aspect-ratio: 1/1;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            background: rgba(255,255,255,0.08);
        }
        .target.active {
            background: rgba(255,215,0,0.2);
            border-color: #ffd700;
            transform: scale(1.05);
        }
        .target:hover {
            background: rgba(255,255,255,0.15);
        }
        .crown {
            font-size: 28px;
        }
        /* æŠ¼æ³¨åŒº */
        .bet-box {
            margin: 20px 0;
            text-align: center;
        }
        .bet-input {
            width: 100px;
            padding: 10px;
            font-size: 18px;
            text-align: center;
            border-radius: 8px;
            border: 2px solid #ffd700;
            background: rgba(0,0,0,0.3);
            color: #fff;
            margin: 0 10px;
        }
        .bet-input:focus {
            outline: none;
            border-color: #fff;
        }
        /* æŒ‰é’®åŒº */
        .btn-box {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        .btn {
            flex: 1;
            padding: 12px 0;
            border-radius: 10px;
            border: none;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-bet {
            background: #4CAF50;
            color: #fff;
        }
        .btn-bet:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .btn-reset {
            background: #ff9800;
            color: #fff;
        }
        /* å¼€å¥–ç»“æœåŒº */
        .result-box {
            margin-top: 25px;
            text-align: center;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .result-title {
            font-size: 18px;
            margin-bottom: 10px;
        }
        .result-icon {
            font-size: 50px;
            margin: 15px 0;
            animation: bounce 0.8s ease;
        }
        .result-desc {
            font-size: 20px;
            font-weight: bold;
        }
        .win {
            color: #4CAF50;
        }
        .lose {
            color: #f44336;
        }
        /* å¼€å¥–å†å²è®°å½•ï¼ˆæ–°å¢æ ¸å¿ƒæ ·å¼ï¼‰ */
        .history-box {
            margin-top: 30px;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .history-title {
            font-size: 16px;
            color: #ffd700;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .history-clear {
            font-size: 12px;
            color: #ccc;
            cursor: pointer;
        }
        .history-clear:hover {
            color: #f44336;
        }
        .history-list {
            max-height: 200px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 8px;
        }
        .history-item {
            padding: 8px 5px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
        }
        .history-item .icon {
            font-size: 18px;
            margin-bottom: 3px;
        }
        .history-item .crown-icon { /* çš‡å† è®°å½•é«˜äº® */
            color: #ffd700;
        }
        .history-item .num {
            font-size: 10px;
            color: #ccc;
        }
        /* åŠ¨ç”» */
        @keyframes bounce {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        /* æç¤ºæ–‡æœ¬ */
        .tip {
            margin-top: 15px;
            font-size: 14px;
            color: #ccc;
            text-align: center;
        }
        /* æ»šåŠ¨æ¡ç¾åŒ– */
        ::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #ffd700;
            border-radius: 2px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- ç§¯åˆ†æ˜¾ç¤º -->
        <div class="score-box">
            å½“å‰ç§¯åˆ†ï¼š<span class="score" id="score">1000</span>
        </div>

        <!-- ç›®æ ‡é€‰æ‹©ï¼ˆâ™ ï¸â™¥ï¸â™£ï¸â™¦ï¸çš‡å† ï¼‰ -->
        <div class="targets">
            <div class="target" data-target="spade" data-rate="3.8">â™ ï¸</div>
            <div class="target" data-target="heart" data-rate="4">â™¥ï¸</div>
            <div class="target" data-target="club" data-rate="4">â™£ï¸</div>
            <div class="target" data-target="diamond" data-rate="4">â™¦ï¸</div>
            <div class="target crown" data-target="crown" data-rate="4">ğŸ‘‘</div>
        </div>

        <!-- æŠ¼æ³¨åŒº -->
        <div class="bet-box">
            æŠ¼æ³¨ç§¯åˆ†ï¼š
            <input type="number" class="bet-input" id="betNum" min="1" value="10" placeholder="1-å½“å‰ç§¯åˆ†">
        </div>

        <!-- æŒ‰é’®åŒº -->
        <div class="btn-box">
            <button class="btn btn-bet" id="betBtn">ç¡®è®¤æŠ¼æ³¨å¹¶å¼€å¥–</button>
            <button class="btn btn-reset" id="resetBtn">é‡ç½®é€‰æ‹©</button>
        </div>

        <!-- å¼€å¥–ç»“æœ -->
        <div class="result-box" id="resultBox">
            <div class="result-title">ç­‰å¾…å¼€å¥–...</div>
            <div class="result-icon" id="resultIcon"></div>
            <div class="result-desc" id="resultDesc"></div>
        </div>

        <!-- å¼€å¥–å†å²è®°å½•ï¼ˆæ–°å¢æ ¸å¿ƒDOMï¼‰ -->
        <div class="history-box">
            <div class="history-title">
                å¼€å¥–å†å²ï¼ˆè¿‘100æœŸï¼‰
                <span class="history-clear" id="clearHistory">æ¸…ç©ºè®°å½•</span>
            </div>
            <div class="history-list" id="historyList"></div>
        </div>

        <!-- è§„åˆ™æç¤º -->
        <div class="tip">
            âœ… å¯é€‰æ‹©1-4ä¸ªç›®æ ‡æŠ¼æ³¨ | ğŸ‘‘çš‡å† æ¦‚ç‡3% | â™ ï¸3.8å€ | å…¶ä½™4å€ | å†å²è®°å½•æœ€å¤šä¿ç•™100æ¡
        </div>
    </div>

    <!-- éŸ³æ•ˆï¼ˆéšè—ï¼‰ -->
    <audio id="openAudio" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3" preload="auto">
    <audio id="winAudio" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" preload="auto">
    <audio id="loseAudio" src="https://assets.mixkit.co/sfx/preview/mixkit-player-losing-or-failing-2042.mp3" preload="auto">

    <script>
        // å…¨å±€å˜é‡ï¼ˆæ–°å¢å†å²è®°å½•ç›¸å…³å˜é‡ï¼‰
        let currentScore = 1000; // åˆå§‹ç§¯åˆ†
        let selectedTargets = []; // é€‰ä¸­çš„ç›®æ ‡
        const crownProb = 0.03; // çš‡å† æ¦‚ç‡3%ï¼ˆ2%-5%åŒºé—´ï¼Œå¯ä¿®æ”¹ï¼‰
        let historyList = []; // å¼€å¥–å†å²æ•°ç»„
        const maxHistory = 100; // æœ€å¤šä¿ç•™100æœŸ
        let issueNum = 1; // æœŸæ•°è‡ªå¢

        // è·å–DOMå…ƒç´ ï¼ˆæ–°å¢å†å²è®°å½•DOMï¼‰
        const scoreEl = document.getElementById('score');
        const targetEls = document.querySelectorAll('.target');
        const betNumEl = document.getElementById('betNum');
        const betBtn = document.getElementById('betBtn');
        const resetBtn = document.getElementById('resetBtn');
        const resultBox = document.getElementById('resultBox');
        const resultIcon = document.getElementById('resultIcon');
        const resultDesc = document.getElementById('resultDesc');
        const historyListEl = document.getElementById('historyList');
        const clearHistoryEl = document.getElementById('clearHistory');
        // éŸ³æ•ˆå…ƒç´ 
        const openAudio = document.getElementById('openAudio');
        const winAudio = document.getElementById('winAudio');
        const loseAudio = document.getElementById('loseAudio');

        // åˆå§‹åŒ–
        init();
        function init() {
            updateScore();
            bindEvents();
        }

        // ç»‘å®šäº‹ä»¶ï¼ˆæ–°å¢æ¸…ç©ºå†å²äº‹ä»¶ï¼‰
        function bindEvents() {
            // é€‰æ‹©ç›®æ ‡ï¼ˆ1-4ä¸ªï¼‰
            targetEls.forEach(el => {
                el.addEventListener('click', () => {
                    const target = el.dataset.target;
                    // æœ€å¤šé€‰4ä¸ªï¼Œå·²é€‰ä¸­åˆ™å–æ¶ˆ
                    if (el.classList.contains('active')) {
                        el.classList.remove('active');
                        selectedTargets = selectedTargets.filter(item => item.target !== target);
                    } else {
                        if (selectedTargets.length >= 4) {
                            alert('æœ€å¤šåªèƒ½é€‰æ‹©4ä¸ªç›®æ ‡å“¦ï¼');
                            return;
                        }
                        el.classList.add('active');
                        selectedTargets.push({
                            target: target,
                            rate: parseFloat(el.dataset.rate)
                        });
                    }
                });
            });

            // ç¡®è®¤æŠ¼æ³¨å¼€å¥–
            betBtn.addEventListener('click', handleBet);

            // é‡ç½®é€‰æ‹©
            resetBtn.addEventListener('click', resetSelect);

            // æ¸…ç©ºå†å²è®°å½•ï¼ˆæ–°å¢ï¼‰
            clearHistoryEl.addEventListener('click', () => {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å¼€å¥–å†å²å—ï¼Ÿ')) {
                    historyList = [];
                    issueNum = 1;
                    renderHistory();
                }
            });
        }

        // æŠ¼æ³¨å¤„ç†
        function handleBet() {
            const betNum = parseInt(betNumEl.value);
            // æ ¡éªŒ
            if (selectedTargets.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©1-4ä¸ªç›®æ ‡å†å¼€å¥–ï¼');
                return;
            }
            if (isNaN(betNum) || betNum < 1) {
                alert('æŠ¼æ³¨ç§¯åˆ†å¿…é¡»å¤§äº0ï¼');
                return;
            }
            if (betNum > currentScore) {
                alert('ç§¯åˆ†ä¸è¶³ï¼Œæ— æ³•æŠ¼æ³¨ï¼');
                return;
            }

            // ç¦ç”¨æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
            betBtn.disabled = true;
            // æ‰£é™¤æŠ¼æ³¨ç§¯åˆ†
            currentScore -= betNum;
            updateScore();
            // æ’­æ”¾å¼€å¥–éŸ³æ•ˆ
            playAudio(openAudio);
            // æ¨¡æ‹Ÿå¼€å¥–å»¶è¿Ÿï¼ˆæ›´çœŸå®ï¼‰
            setTimeout(() => {
                const result = randomResult(); // éšæœºå¼€å¥–ç»“æœ
                showResult(result, betNum); // æ˜¾ç¤ºç»“æœ
                addToHistory(result); // æ–°å¢ï¼šæ·»åŠ åˆ°å†å²è®°å½•
                betBtn.disabled = false;
            }, 1200);
        }

        // å®Œå…¨éšæœºå¼€å¥–ï¼ˆæ ¸å¿ƒï¼šçš‡å† 3%ï¼Œå…¶ä»–4ç§å‡åˆ†97%ï¼‰
        function randomResult() {
            const random = Math.random(); // 0-1éšæœºæ•°
            // çš‡å† æ¦‚ç‡3%
            if (random < crownProb) {
                return { target: 'crown', icon: 'ğŸ‘‘' };
            }
            // å…¶ä»–4ç§èŠ±è‰²å‡åˆ†97%ï¼ˆå„çº¦24.25%ï¼‰
            const flowerRandom = Math.random();
            if (flowerRandom < 0.25) return { target: 'spade', icon: 'â™ ï¸' };
            if (flowerRandom < 0.5) return { target: 'heart', icon: 'â™¥ï¸' };
            if (flowerRandom < 0.75) return { target: 'club', icon: 'â™£ï¸' };
            return { target: 'diamond', icon: 'â™¦ï¸' };
        }

        // æ˜¾ç¤ºå¼€å¥–ç»“æœï¼ˆä¸­å¥–/æœªä¸­å¥–ï¼‰
        function showResult(result, betNum) {
            const winTarget = selectedTargets.find(item => item.target === result.target);
            resultIcon.innerHTML = result.icon;
            
            if (winTarget) {
                // ä¸­å¥–ï¼šè®¡ç®—å¥–é‡‘ï¼ˆæŠ¼æ³¨æ•°*èµ”ç‡ï¼‰
                const bonus = Math.floor(betNum * winTarget.rate);
                currentScore += bonus;
                updateScore();
                resultDesc.className = 'result-desc win';
                resultDesc.innerHTML = `æ­å–œä¸­å¥–ï¼å¥–é‡‘${bonus}ç§¯åˆ†<br>èµ”ç‡${winTarget.rate}å€`;
                playAudio(winAudio); // ä¸­å¥–éŸ³æ•ˆ
            } else {
                // æœªä¸­å¥–
                resultDesc.className = 'result-desc lose';
                resultDesc.innerHTML = 'å¾ˆé—æ†¾ï¼Œæœªä¸­å¥–';
                playAudio(loseAudio); // æœªä¸­å¥–éŸ³æ•ˆ
            }
        }

        // æ–°å¢ï¼šæ·»åŠ å¼€å¥–è®°å½•åˆ°å†å²
        function addToHistory(result) {
            const now = new Date();
            const time = `${now.getHours().toString().padStart(2,0)}:${now.getMinutes().toString().padStart(2,0)}:${now.getSeconds().toString().padStart(2,0)}`;
            // æ–°å¢è®°å½•
            historyList.unshift({
                issue: issueNum++, // æœŸæ•°
                icon: result.icon,
                target: result.target,
                time: time
            });
            // è¶…è¿‡100æ¡ï¼Œåˆ é™¤æœ€åä¸€æ¡ï¼ˆæœ€æ—©è®°å½•ï¼‰
            if (historyList.length > maxHistory) {
                historyList.pop();
            }
            // æ¸²æŸ“å†å²è®°å½•
            renderHistory();
        }

        // æ–°å¢ï¼šæ¸²æŸ“å†å²è®°å½•åˆ°é¡µé¢
        function renderHistory() {
            if (historyList.length === 0) {
                historyListEl.innerHTML = '<div style="grid-column: 1/-1; color:#ccc; padding:20px 0;">æš‚æ— å¼€å¥–è®°å½•</div>';
                return;
            }
            historyListEl.innerHTML = historyList.map(item => `
                <div class="history-item">
                    <div class="icon ${item.target === 'crown' ? 'crown-icon' : ''}">${item.icon}</div>
                    <div class="num">ç¬¬${item.issue}æœŸ</div>
                </div>
            `).join('');
        }

        // æ›´æ–°ç§¯åˆ†æ˜¾ç¤º
        function updateScore() {
            scoreEl.innerText = currentScore;
            betNumEl.max = currentScore; // æŠ¼æ³¨ä¸Šé™=å½“å‰ç§¯åˆ†
        }

        // é‡ç½®é€‰æ‹©
        function resetSelect() {
            selectedTargets = [];
            targetEls.forEach(el => el.classList.remove('active'));
            resultDesc.innerHTML = '';
            resultIcon.innerHTML = '';
        }

        // æ’­æ”¾éŸ³æ•ˆ
        function playAudio(audio) {
            audio.currentTime = 0; // é‡ç½®æ’­æ”¾ä½ç½®
            audio.play().catch(err => console.log('éŸ³æ•ˆæ’­æ”¾å¤±è´¥', err));
        }
    </script>
</body>
</html>